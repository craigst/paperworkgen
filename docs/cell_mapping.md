# Cell Mapping Reference

This reference ties the JSON payload fields accepted by the HTTP API to the cells in the Excel templates under `templates/loadsheet.xlsx` and `templates/timesheet.xlsx`. Use this guide when you are composing payloads in n8n so you can see what each value will replace in the workbook.

## Loadsheet Template (`templates/loadsheet.xlsx`)

### Header and metadata

| JSON field | Excel cell | Notes |
|------------|------------|-------|
| `load_date` | C6 & C46/H46 | Date shown in header and repeated under both signature areas (formatted as `Monday DD/MM/YY`). |
| `load_number` | G6 | Visible load identifier. |
| `fleet_reg` | C7 | Shown near the header. |
| `collection_point` | B9 | Upper-left label (upper-cased). |
| `delivery_point` | F9 | Upper-right label (upper-cased). |
| `load_notes` | Appended below the summary in C39 | Additional free text following the autogenerated summary sentence. |

### Vehicle rows (slots 1-8)

| Slot | Make/model | Reg | Offloaded | Docs | Spare keys | Notes |
|------|------------|-----|-----------|------|------------|-------|
| 1 | B11 | B13 | E10 | G10 | I10 | C11 |
| 2 | B15 | B17 | E14 | G14 | I14 | C15 |
| 3 | B19 | B21 | E18 | G18 | I18 | C19 |
| 4 | B23 | B25 | E22 | G22 | I22 | C23 |
| 5 | B27 | B29 | E26 | G26 | I26 | C27 |
| 6 | B31 | B33 | E30 | G30 | I30 | C31 |
| 7 | B35 | B37 | E34 | G34 | I34 | C35 |
| 8 | B39 | B41 | E38 | G38 | I38 | C39 |

Each `CarModel` in the request is upper-cased and written into the corresponding slot (summary and per-car notes are upper-cased as well). The `offloaded`, `docs`, and `spare_keys` flags must be `'Y'` or `'N'`.

### Summary & signatures

| Purpose | Cell |
|---------|------|
| Auto-generated summary (e.g., `3 CARS LOADED, 3 CARS HAVE DOCUMENTS…`) and appended notes | C39 |
| Signature 1 image | C42 |
| Signature 2 image | H42 |
| Collection/delivery signature dates | C46 / H46 |

Files are written to `output/<DD-MM-YY>/` where `<DD-MM-YY>` is the Sunday of the `load_date` week, and the Excel workbook name is `<load_number>_<collection_point_sanitized>.xlsx`.

## Timesheet Template (`templates/timesheet.xlsx`)

### Header fields

| JSON field | Excel cell | Notes |
|------------|------------|-------|
| `week_ending` | E5 | Week-ending Sunday formatted as `Monday DD/MM/YY`. |
| `driver` | H2 | Upper-cased driver name. |
| `fleet_reg` | K5 | Comma-separated list of fleet regs (duplicates removed). |
| `start_mileage` / `end_mileage` | H4 / H5 | Free-text mileage values. |
| `weekly_total_hours` | J29 | Overrides the sum of the daily `total_hours` when provided. |
| `include_pdf` | API flag | Only affects whether LibreOffice is invoked; does not write to a cell. |

### Daily rows (Monday → Sunday)

| Field | Excel cells | Notes |
|-------|-------------|-------|
| Day loads (slots 1-3) | `C/D/E/F/G` rows 8→26 | Each load writes contractor, car count, collection, delivery, and optional note. |
| Start time | `H8-26` | Accepts `HH:MM`, `SICK`, `HOLIDAY`, etc. |
| Finish time | `I8-26` | Mirrored for special markers. |
| Total hours | `J8-26` | Numeric totals provided in JSON (empty values remain empty). |

Overflow loads (more than three per day) are written starting at row 29 with the date in column B and the same field mapping (columns C→G). The helper logic derives the date for each overflow row using the `week_ending` date and the weekday order.

### Signatures

Only the loadsheet template (`templates/loadsheet.xlsx`) embeds signatures via `signatures/sig1`/`sig2`; the timesheet template does not render signatures, so no extra fields or images need to be supplied for `/api/timesheet/generate`.

Use these tables when composing n8n payloads so you know exactly which JSON value lands in which workbook cell. The `docs/project_plan.md` and the legacy `sql_host`/`sql-to-docs` repositories contain additional reasoning about the payload shapes and data sources if you need to align with those schemas.
